<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>محاسبه اقساط</title>

<style>
body{font-family:tahoma;direction:rtl;background:#f2f2f2;margin:0}
.page{background:#fff;max-width:700px;margin:20px auto;padding:20px}
input,button{width:100%;padding:10px;margin:6px 0;font-size:14px}
button{background:#5a2ea6;color:#fff;border:none}
.box{margin-top:10px;padding:10px;border:1px solid #ccc;white-space:pre-line}
</style>
</head>
<body>

<div class="page">
<h3>محاسبه اقساط</h3>

<input id="area" placeholder="متراژ">
<input id="pricePerMeter" class="money" placeholder="قیمت هر متر">
<input id="total" class="money" placeholder="مبلغ کل" readonly>

<input id="cash" class="money" placeholder="نقدی">
<input id="delivery" class="money" placeholder="تحویل">
<input id="doc" class="money" placeholder="سند">

<input id="count" placeholder="تعداد اقساط">
<input id="gap" placeholder="فاصله اقساط (ماه)">
<input id="percent" placeholder="درصد اقساط (اختیاری)">

<button onclick="calc()">محاسبه</button>

<div id="result" class="box"></div>
</div>

<script>
// ---------- سه‌رقمی قطعی ----------
function formatMoney(v){
  v = v.replace(/,/g,'').replace(/\D/g,'');
  return v.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

document.addEventListener('input',e=>{
  if(e.target.classList.contains('money')){
    e.target.value = formatMoney(e.target.value);
  }
});

function num(id){
  return Number(document.getElementById(id).value.replace(/,/g,'')) || 0;
}

// ---------- مبلغ کل ----------
document.getElementById('area').addEventListener('input',calcTotal);
document.getElementById('pricePerMeter').addEventListener('input',calcTotal);

function calcTotal(){
  let t = (Number(area.value)||0) * num('pricePerMeter');
  total.value = t ? formatMoney(String(t)) : '';
}

// ---------- محاسبه اقساط ----------
function calc(){
  let totalVal = num('total');
  let cash = num('cash');
  let delivery = num('delivery');
  let doc = num('doc');

  let count = Number(document.getElementById('count').value) || 1;
  let gap = Number(document.getElementById('gap').value) || 1;

  let percentInput = document.getElementById('percent').value;
  let percent = percentInput ? Number(percentInput)/100 :
    ((count*gap)<=6 ? 0.04 : (count*gap)<=12 ? 0.06 : 0.08);

  let net = totalVal - (cash + delivery + doc);
  let base = net / count;

  let txt = '';
  for(let i>=1;i<=count;i++){
    let inst = base;
    if(i>1) inst += base * percent * i * gap;
    txt += `قسط ${i}: ${Math.round(inst).toLocaleString()} تومان\n`;
  }

  document.getElementById('result').textContent = txt;
}
</script>

</body>
</html>
