<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{font-family:-apple-system,Tahoma;direction:rtl;background:#eee;margin:0}
.page{background:#fff;max-width:800px;margin:10px auto;padding:20px}
h2{text-align:center}
input,button{
  width:100%;padding:10px;margin:6px 0;
  font-size:15px;border-radius:6px;border:1px solid #ccc
}
input[readonly]{background:#f3f3f3}
button{background:#7b2cbf;color:#fff;border:none}
.row{display:flex;gap:10px}
.row>div{flex:1}
.box{border:1px solid #ddd;padding:10px;margin-top:10px;border-radius:6px;white-space:pre-line}
.bold{font-weight:bold}
@media print{
  button{display:none}
  body{background:#fff}
  .page{margin:0}
}
</style>
</head>
<body>

<div class="page">
<h2>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</h2>

<!-- Ù…ØªØ±Ø§Ú˜ -->
<div class="row">
  <div><input id="area" placeholder="Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)"></div>
  <div><input class="money" id="pricePerMeter" placeholder="Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±"></div>
</div>

<input class="money" id="total" placeholder="Ù…Ø¨Ù„Øº Ú©Ù„" readonly>

<hr>

<!-- Ù¾Ø±Ø¯Ø§Ø®Øª -->
<div class="row">
  <div><input class="money" id="cash" placeholder="Ù†Ù‚Ø¯ÛŒ"></div>
  <div><input class="money" id="delivery" placeholder="ØªØ­ÙˆÛŒÙ„"></div>
  <div><input class="money" id="doc" placeholder="Ø³Ù†Ø¯"></div>
</div>

<div class="row">
  <div><input id="count" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·"></div>
  <div><input id="gap" placeholder="ÙØ§ØµÙ„Ù‡ Ø§Ù‚Ø³Ø§Ø· (Ù…Ø§Ù‡)"></div>
</div>

<input id="percent" placeholder="Ø¯Ø±ØµØ¯ (Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ)">

<button onclick="calc()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù‚Ø³Ø§Ø·</button>
<button onclick="window.print()">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª</button>

<div class="box bold" id="netBox"></div>
<div class="box" id="result"></div>
<div class="box bold" id="equalBox"></div>
<div class="box bold" id="sumBox"></div>

</div>

<script>
// Ø³Ù‡â€ŒØ±Ù‚Ù…ÛŒ Ø­ÛŒÙ† ØªØ§ÛŒÙ¾
document.querySelectorAll('.money').forEach(i=>{
  i.addEventListener('input',e=>{
    let v=e.target.value.replace(/,/g,'').replace(/\D/g,'');
    if(v===''){e.target.value='';return;}
    e.target.value=Number(v).toLocaleString();
  });
});

function val(id){
  return Number(document.getElementById(id).value.replace(/,/g,''))||0;
}

// Ù…Ø¨Ù„Øº Ú©Ù„
areaEl=area;
pricePerMeterEl=pricePerMeter;
areaEl.oninput=pricePerMeterEl.oninput=()=>{
  let t=(Number(areaEl.value)||0)*val('pricePerMeter');
  total.value=t?t.toLocaleString():'';
};

function calc(){
  let totalVal=val('total');
  let cash=val('cash');
  let delivery=val('delivery');
  let doc=val('doc');
  let count=Number(countEl.value);
  let gap=Number(gapEl.value);
  let areaVal=Number(areaEl.value)||1;

  let percentInput=percentEl.value.replace('%','');
  let percent;
  if(percentInput){
    percent=Number(percentInput)/100;
  }else{
    let duration=count*gap;
    percent=duration<=6?0.04:duration<=12?0.06:0.08;
    percentEl.value=(percent*100);
  }

  let net=totalVal-(cash+delivery+doc);
  netBox.textContent='Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ ØªÙ‚Ø³ÛŒØ·: '+net.toLocaleString()+' ØªÙˆÙ…Ø§Ù†';

  let base=net/count;
  let sumInst=0;
  let txt='';

  for(let i=1;i<=count;i++){
    let inst=base;
    if(i>=1) inst+=base*percent*i*gap;
    sumInst+=inst;
    txt+=`Ù‚Ø³Ø· ${i}: ${Math.round(inst).toLocaleString()} ØªÙˆÙ…Ø§Ù†\n`;
  }
  result.textContent=txt;

  let equalInst=sumInst/count;
  equalBox.textContent='Ù‚Ø³Ø· Ù…Ø³Ø§ÙˆÛŒ (Ù†Ù…Ø§ÛŒØ´ÛŒ): '+Math.round(equalInst).toLocaleString()+' ØªÙˆÙ…Ø§Ù†';

  let totalPaid=sumInst+cash+delivery+doc;
  let newPricePerMeter=totalPaid/areaVal;

  sumBox.textContent=
    'Ø¬Ù…Ø¹ Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: '+Math.round(totalPaid).toLocaleString()+
    ' ØªÙˆÙ…Ø§Ù†\nÙ‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ± Ù†Ù‡Ø§ÛŒÛŒ: '+Math.round(newPricePerMeter).toLocaleString()+' ØªÙˆÙ…Ø§Ù†';
}

const countEl=count;
const gapEl=gap;
const percentEl=percent;
</script>

</body>
</html>
