<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</title>

<style>
body{
  font-family:tahoma;
  direction:rtl;
  background:#eee;
  margin:0
}
.page{
  background:#fff;
  max-width:800px;
  margin:10px auto;
  padding:20px
}
h2{text-align:center}

input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
  border-radius:6px;
  border:1px solid #ccc
}
input[readonly]{background:#f3f3f3}

button{
  background:#7b2cbf;
  color:#fff;
  border:none
}

.row{
  display:flex;
  gap:10px
}
.row > div{flex:1}

.box{
  border:1px solid #ddd;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  white-space:pre-line
}
.bold{font-weight:bold}

@media print{
  button{display:none}
  body{background:#fff}
  .page{margin:0}
}
</style>
</head>
<body>

<div class="page">
<h2>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</h2>

<!-- Ù…ØªØ±Ø§Ú˜ -->
<div class="row">
  <div><input id="area" placeholder="Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)"></div>
  <div><input id="pricePerMeter" class="money" placeholder="Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±"></div>
</div>

<input id="total" class="money" placeholder="Ù…Ø¨Ù„Øº Ú©Ù„" readonly>

<hr>

<!-- Ù¾Ø±Ø¯Ø§Ø®Øª -->
<div class="row">
  <div><input id="cash" class="money" placeholder="Ù†Ù‚Ø¯ÛŒ"></div>
  <div><input id="delivery" class="money" placeholder="ØªØ­ÙˆÛŒÙ„"></div>
  <div><input id="doc" class="money" placeholder="Ø³Ù†Ø¯"></div>
</div>

<div class="row">
  <div><input id="count" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·"></div>
  <div><input id="gap" placeholder="ÙØ§ØµÙ„Ù‡ Ø§Ù‚Ø³Ø§Ø· (Ù…Ø§Ù‡)"></div>
</div>

<input id="percent" placeholder="Ø¯Ø±ØµØ¯ (Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ)">

<button onclick="calc()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
<button onclick="window.print()">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª</button>

<div id="netBox" class="box bold"></div>
<div id="result" class="box"></div>
<div id="equalBox" class="box bold"></div>
<div id="sumBox" class="box bold"></div>

</div>

<script>
// Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø³Ù‡â€ŒØ±Ù‚Ù…ÛŒ Ø­ÛŒÙ† ØªØ§ÛŒÙ¾
document.querySelectorAll('.money').forEach(i=>{
  i.addEventListener('input',e=>{
    let v = e.target.value.replace(/,/g,'').replace(/\D/g,'');
    e.target.value = v ? Number(v).toLocaleString() : '';
  });
});

function num(id){
  const el = document.getElementById(id);
  if(!el || !el.value) return 0;
  return Number(el.value.replace(/,/g,'')) || 0;
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú©Ù„ Ø§Ø² Ù…ØªØ±Ø§Ú˜
area.addEventListener('input',calcTotal);
pricePerMeter.addEventListener('input',calcTotal);

function calcTotal(){
  const t = (Number(area.value)||0) * num('pricePerMeter');
  total.value = t ? t.toLocaleString() : '';
}

function calc(){

  const totalVal = num('total');
  const cash = num('cash');
  const delivery = num('delivery');
  const doc = num('doc');

  const count = Number(document.getElementById('count').value) || 1;
  const gap = Number(document.getElementById('gap').value) || 1;
  const areaVal = Number(area.value) || 1;

  // Ø¯Ø±ØµØ¯ Ø¯Ø³ØªÛŒ ÛŒØ§ Ø®ÙˆØ¯Ú©Ø§Ø±
  const percentEl = document.getElementById('percent');
  let percent;

  if(percentEl.value){
    percent = Number(percentEl.value)/100;
  }else{
    const duration = count * gap;
    percent = duration <= 6 ? 0.04 : duration <= 12 ? 0.06 : 0.08;
    percentEl.value = percent * 100;
  }

  // Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ ØªÙ‚Ø³ÛŒØ·
  const net = totalVal - (cash + delivery + doc);
  netBox.textContent =
    'Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ ØªÙ‚Ø³ÛŒØ·: ' + net.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';

  const base = net / count;

  let sumInstallments = 0;
  let text = '';

  for(let i=1;i<=count;i++){
    let inst = base;
    if(i > 1){
      inst += base * percent * i * gap;
    }
    sumInstallments += inst;
    text += `Ù‚Ø³Ø· ${i}: ${Math.round(inst).toLocaleString()} ØªÙˆÙ…Ø§Ù†\n`;
  }

  result.textContent = text;

  // Ù‚Ø³Ø· Ù…Ø³Ø§ÙˆÛŒ
  equalBox.textContent =
    'Ù‚Ø³Ø· Ù…Ø³Ø§ÙˆÛŒ (Ù†Ù…Ø§ÛŒØ´ÛŒ): ' +
    Math.round(sumInstallments / count).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';

  // Ø¬Ù…Ø¹ Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ùˆ Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ Ù…ØªØ±
  const totalPaid = sumInstallments + cash + delivery + doc;
  sumBox.textContent =
    'Ø¬Ù…Ø¹ Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: ' + Math.round(totalPaid).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†\n' +
    'Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ± Ù†Ù‡Ø§ÛŒÛŒ: ' +
    Math.round(totalPaid / areaVal).toLocaleString() + ' ØªÙˆÙ…Ø§Ù†';
}
</script>

</body>
</html>
