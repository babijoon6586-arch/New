<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</title>

<style>
body{
  font-family:tahoma;
  direction:rtl;
  background:#eee;
  margin:0
}
.page{
  background:#fff;
  max-width:800px;
  margin:10px auto;
  padding:20px
}
h2{text-align:center}

.topbar{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:10px
}

input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:14px;
  border-radius:6px;
  border:1px solid #ccc
}
input[readonly]{background:#f3f3f3}

button{
  background:#7b2cbf;
  color:#fff;
  border:none
}

.row{
  display:flex;
  gap:10px
}
.row>div{flex:1}

.box{
  border:1px solid #ddd;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  white-space:pre-line
}
.bold{font-weight:bold}

/* Ù¾Ø±ÛŒÙ†Øª */
@media print{
  button,input,.hide-print{display:none}
  body{background:#fff}
  .page{margin:0}
  .print-only{display:block}
}
.print-only{display:none;font-weight:bold}
</style>
</head>
<body>

<div class="page">

<div class="topbar">
  <div id="date"></div>
  <div id="time"></div>
</div>

<h2>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</h2>

<div class="row hide-print">
  <div><input id="area" placeholder="Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)"></div>
  <div><input id="pricePerMeter" class="money" placeholder="Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±"></div>
</div>

<input id="total" class="money hide-print" placeholder="Ù…Ø¨Ù„Øº Ú©Ù„" readonly>

<div class="row hide-print">
  <div><input id="discountPercent" placeholder="Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ"></div>
  <div><input id="discountAmount" class="money" placeholder="Ù…Ø¨Ù„Øº ØªØ®ÙÛŒÙ"></div>
</div>

<div class="row hide-print">
  <div><input id="cash" class="money" placeholder="Ù†Ù‚Ø¯ÛŒ"></div>
  <div><input id="delivery" class="money" placeholder="ØªØ­ÙˆÛŒÙ„"></div>
  <div><input id="doc" class="money" placeholder="Ø³Ù†Ø¯"></div>
</div>

<div class="row hide-print">
  <div><input id="count" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·"></div>
  <div><input id="gap" placeholder="ÙØ§ØµÙ„Ù‡ Ø§Ù‚Ø³Ø§Ø· (Ù…Ø§Ù‡)"></div>
</div>

<input id="percent" class="hide-print" placeholder="Ø¯Ø±ØµØ¯ Ø§Ù‚Ø³Ø§Ø·">

<input id="startDate" type="date" class="hide-print">

<button onclick="calc()" class="hide-print">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
<button onclick="window.print()" class="hide-print">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª</button>

<div id="equalBox" class="box bold"></div>

<!-- Ù…Ø®ØµÙˆØµ Ù¾Ø±ÛŒÙ†Øª -->
<div class="box print-only">
ØªØ§Ø±ÛŒØ®: <span id="pDate"></span><br>
Ù…ØªØ±Ø§Ú˜: <span id="pArea"></span> Ù…ØªØ±<br>
Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±: <span id="pPrice"></span> ØªÙˆÙ…Ø§Ù†<br>
Ù‚Ø³Ø· Ù…Ø³Ø§ÙˆÛŒ: <span id="pInstallment"></span> ØªÙˆÙ…Ø§Ù†<br>
Ø´Ø±ÙˆØ¹ Ø§Ù‚Ø³Ø§Ø·: <span id="pStart"></span>
</div>

</div>

<script>
// Ø³Ø§Ø¹Øª Ùˆ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
function updateTime(){
  const now=new Date();
  time.textContent=now.toLocaleTimeString('fa-IR');
  date.textContent=now.toLocaleDateString('fa-IR');
}
setInterval(updateTime,1000);updateTime();

// Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø³Ù‡â€ŒØ±Ù‚Ù…ÛŒ Ø­ÛŒÙ† ØªØ§ÛŒÙ¾ (Ù‡Ù…Ù‡ money)
document.addEventListener('input',function(e){
  if(!e.target.classList.contains('money')) return;
  let v=e.target.value.replace(/,/g,'').replace(/\D/g,'');
  e.target.value=v?Number(v).toLocaleString():'';
});

function num(id){
  const el=document.getElementById(id);
  return el&&el.value?Number(el.value.replace(/,/g,'')):0;
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú©Ù„
area.addEventListener('input',calcTotal);
pricePerMeter.addEventListener('input',calcTotal);

function calcTotal(){
  const t=(Number(area.value)||0)*num('pricePerMeter');
  total.value=t?t.toLocaleString():'';
}

function calc(){
  let totalVal=num('total');

  // ØªØ®ÙÛŒÙ
  if(discountPercent.value)
    totalVal-=totalVal*(Number(discountPercent.value)/100);
  if(discountAmount.value)
    totalVal-=num('discountAmount');

  const cash=num('cash'),
        delivery=num('delivery'),
        doc=num('doc');

  const cnt=Number(count.value)||1;
  const gp=Number(gap.value)||1;
  const areaVal=Number(area.value)||1;

  let percentVal;
  if(percent.value){
    percentVal=Number(percent.value)/100;
  }else{
    const d=cnt*gp;
    percentVal=d<=6?0.04:d<=12?0.06:0.08;
    percent.value=percentVal*100;
  }

  let net=totalVal-(cash+delivery+doc);
  let base=net/cnt;
  let sum=0;

  for(let i>=1;i<=cnt;i++)
    sum+=base+(i>1?base*percentVal*i*gp:0);

  const equal=Math.round(sum/cnt);
  equalBox.textContent='Ù‚Ø³Ø· Ù…Ø³Ø§ÙˆÛŒ: '+equal.toLocaleString()+' ØªÙˆÙ…Ø§Ù†';

  // Ø¯Ø§Ø¯Ù‡ Ù¾Ø±ÛŒÙ†Øª
  pDate.textContent=date.textContent;
  pArea.textContent=areaVal;
  pPrice.textContent=num('pricePerMeter').toLocaleString();
  pInstallment.textContent=equal.toLocaleString();
  pStart.textContent=startDate.value||'-';
}
</script>

</body>
</html>
