<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
  font-family:-apple-system, Tahoma;
  direction:rtl;
  background:#eee;
  margin:0;
}
.page{
  background:#fff;
  margin:10px auto;
  padding:20px;
  max-width:800px;
}
h2{text-align:center;margin-bottom:20px}

input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  font-size:15px;
  border-radius:6px;
  border:1px solid #ccc;
}
input[readonly]{background:#f3f3f3}
button{
  background:#7b2cbf;
  color:#fff;
  border:none;
}

.row{
  display:flex;
  gap:10px;
}
.row > div{flex:1}

.box{
  border:1px solid #ddd;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  white-space:pre-line;
}

.bold{font-weight:bold}

@media print{
  button{display:none}
  body{background:#fff}
  .page{margin:0}
}
</style>
</head>
<body>

<div class="page">

<h2>Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´</h2>

<!-- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª -->
<div class="row">
  <div><input id="area" placeholder="Ù…ØªØ±Ø§Ú˜ (Ù…ØªØ± Ù…Ø±Ø¨Ø¹)"></div>
  <div><input class="money" id="pricePerMeter" placeholder="Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±"></div>
</div>

<input class="money" id="total" placeholder="Ù…Ø¨Ù„Øº Ú©Ù„" readonly>

<hr>

<!-- Ù¾Ø±Ø¯Ø§Ø®Øª -->
<div class="row">
  <div><input class="money" id="cash" placeholder="Ù†Ù‚Ø¯ÛŒ"></div>
  <div><input class="money" id="delivery" placeholder="ØªØ­ÙˆÛŒÙ„"></div>
  <div><input class="money" id="doc" placeholder="Ø³Ù†Ø¯"></div>
</div>

<div class="row">
  <div><input id="count" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·"></div>
  <div><input id="gap" placeholder="ÙØ§ØµÙ„Ù‡ Ø§Ù‚Ø³Ø§Ø· (Ù…Ø§Ù‡)"></div>
</div>

<input id="percent" placeholder="Ø¯Ø±ØµØ¯" readonly>

<button onclick="calc()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù‚Ø³Ø§Ø·</button>
<button onclick="window.print()">ğŸ–¨ï¸ Ù¾Ø±ÛŒÙ†Øª Ù¾ÛŒØ´ ÙØ§Ú©ØªÙˆØ±</button>

<div class="box bold" id="netBox"></div>
<div class="box" id="result"></div>
<div class="box bold" id="sumBox"></div>

</div>

<script>
// Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø³Ù‡â€ŒØ±Ù‚Ù…ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
document.querySelectorAll('.money').forEach(input=>{
  input.addEventListener('input',e=>{
    let v=e.target.value.replace(/,/g,'').replace(/\D/g,'');
    if(v===''){e.target.value='';return;}
    e.target.value=Number(v).toLocaleString();
  });
});

// Ø¯Ø±ÛŒØ§ÙØª Ø¹Ø¯Ø¯
function val(id){
  return Number(document.getElementById(id).value.replace(/,/g,''))||0;
}

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú©Ù„
function calcTotal(){
  let area=Number(areaEl.value)||0;
  let price=val('pricePerMeter');
  let total=area*price;
  totalEl.value=total?total.toLocaleString():'';
}
areaEl=document.getElementById('area');
pricePerMeterEl=document.getElementById('pricePerMeter');
totalEl=document.getElementById('total');
areaEl.addEventListener('input',calcTotal);
pricePerMeterEl.addEventListener('input',calcTotal);

function calc(){
  let total=val('total');
  let cash=val('cash');
  let delivery=val('delivery');
  let doc=val('doc');
  let count=Number(countEl.value);
  let gap=Number(gapEl.value);

  let duration=count*gap;
  let percent=duration<=6?0.04:duration<=12?0.06:0.08;
  percentEl.value=(percent*100)+' %';

  let net=total-(cash+delivery+doc);
  netBox.textContent='Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ ØªÙ‚Ø³ÛŒØ·: '+net.toLocaleString()+' ØªÙˆÙ…Ø§Ù†';

  let base=net/count;
  let sumInstallments=0;
  let text='';

  for(let i=1;i<=count;i++){
    let inst=base;
    if(i>=1) inst+=base*percent*i*gap;
    sumInstallments+=inst;
    text+=`Ù‚Ø³Ø· ${i}: ${Math.round(inst).toLocaleString()} ØªÙˆÙ…Ø§Ù†\n`;
  }
  result.textContent=text;

  let totalPaid=sumInstallments+cash+delivery+doc;
  sumBox.textContent='Ø¬Ù…Ø¹ Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ: '+Math.round(totalPaid).toLocaleString()+' ØªÙˆÙ…Ø§Ù†';
}

const countEl=document.getElementById('count');
const gapEl=document.getElementById('gap');
const percentEl=document.getElementById('percent');
</script>

</body>
</html>
